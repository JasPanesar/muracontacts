this.muracontacts=this.muracontacts||{},this.muracontacts.templates=this.muracontacts.templates||{},window.mura.Handlebars.registerPartial("contactlistitem",window.mura.Handlebars.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return'<tr>\n\n  <!-- Contact Name -->\n  <td>\n    <a class="btn" href="./#mcaction=edit&amp;pid='+h(g(null!=(f=null!=b?b.properties:b)?f.personid:f,b))+'">\n      '+h(g(null!=(f=null!=b?b.properties:b)?f.fullname:f,b))+'\n    </a>\n  </td>\n\n  <td class="right">\n    <!-- Edit -->\n    <a class="btn btn-success" href="./#mcaction=edit&amp;pid='+h(g(null!=(f=null!=b?b.properties:b)?f.personid:f,b))+'">\n      <i class="fa fa-pencil"></i>\n    </a>\n\n    <!-- Delete -->\n    <form method="post" class="muracontacts-form muracontacts-formlink">\n      <input type="hidden" name="mcaction" value="delete">\n      <input type="hidden" name="pid" value="'+h(g(null!=(f=null!=b?b.properties:b)?f.personid:f,b))+'">\n      <button type="submit" class="btn btn-danger btn-delete btn-delete-contact">\n        <i class="fa fa-trash"></i>\n      </button>\n    </form>\n  </td>\n\n</tr>\n'},useData:!0})),window.mura.Handlebars.registerPartial("phonelistitem",window.mura.Handlebars.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return'<li class="muracontacts-phonenumber">\n  <!-- Edit -->\n  <a class="btn btn-sm btn-primary" href="./#mcaction=editphone&amp;pid='+h(g(null!=(f=null!=b?b.properties:b)?f.personid:f,b))+"&amp;phoneid="+h(g(null!=(f=null!=b?b.properties:b)?f.phonenumberid:f,b))+'">\n    <i class="fa fa-pencil"></i>\n  </a>\n\n  <!-- Phone Number -->\n  <a class="btn" href="tel:'+h(g(null!=(f=null!=b?b.properties:b)?f.phonenumber:f,b))+'">\n    '+h(g(null!=(f=null!=b?b.properties:b)?f.phonenumber:f,b))+"\n    <strong>"+h(g(null!=(f=null!=b?b.properties:b)?f.phonetype:f,b))+"</strong>\n  </a>\n</li>\n"},useData:!0})),this.muracontacts.templates.body=window.mura.Handlebars.template({1:function(a,b,c,d,e){var f;return'    <div class="muracontacts-heading">\n      <h2>'+a.escapeExpression((f=null!=(f=c.userfirstname||(null!=b?b.userfirstname:b))?f:c.helperMissing,"function"==typeof f?f.call(null!=b?b:{},{name:"userfirstname",hash:{},data:e}):f))+"'s Contacts</h2>\n    </div>\n"},3:function(a,b,c,d,e){var f,g=a.lambda;return'    <div class="muracontacts-alert alert alert-'+a.escapeExpression(g(null!=(f=null!=b?b.message:b)?f.type:f,b))+' alert-dismissible" role="alert">\n      <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n      <p>'+(null!=(f=g(null!=(f=null!=b?b.message:b)?f.text:f,b))?f:"")+"</p>\n    </div>\n"},5:function(a,b,c,d,e){var f,g;return'    <div class="muracontacts-body">\n      '+(null!=(g=null!=(g=c.body||(null!=b?b.body:b))?g:c.helperMissing,f="function"==typeof g?g.call(null!=b?b:{},{name:"body",hash:{},data:e}):g)?f:"")+"\n    </div>\n"},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=null!=b?b:{};return'<div class="muracontacts-wrapper">\n\n  <!-- Heading -->\n'+(null!=(f=c.if.call(g,null!=b?b.userfirstname:b,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.noop,data:e}))?f:"")+"\n  <!-- Messaging -->\n"+(null!=(f=c.if.call(g,null!=b?b.message:b,{name:"if",hash:{},fn:a.program(3,e,0),inverse:a.noop,data:e}))?f:"")+"\n  <!-- Body -->\n"+(null!=(f=c.if.call(g,null!=b?b.body:b,{name:"if",hash:{},fn:a.program(5,e,0),inverse:a.noop,data:e}))?f:"")+"\n</div>\n<!-- @end muracontacts-wrapper -->\n"},useData:!0}),this.muracontacts.templates.contactlisttable=window.mura.Handlebars.template({1:function(a,b,c,d,e){var f;return null!=(f=c.each.call(null!=b?b:{},null!=b?b.people:b,{name:"each",hash:{},fn:a.program(2,e,0),inverse:a.noop,data:e}))?f:""},2:function(a,b,c,d,e){var f;return null!=(f=a.invokePartial(d.contactlistitem,b,{name:"contactlistitem",data:e,indent:"        ",helpers:c,partials:d,decorators:a.decorators}))?f:""},4:function(a,b,c,d,e){return'      <tr>\n        <td colspan="2" class="info">\n          <i class="fa fa-info-circle"></i> No contacts exist yet.\n        </td>\n      </tr>\n'},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="table-responsive">\n  <table class="table-condensed table-hover">\n\n    <thead>\n      <tr>\n        <th>Name</th>\n        <th>&nbsp;</th>\n      </tr>\n    </thead>\n\n'+(null!=(f=c.if.call(null!=b?b:{},null!=(f=null!=b?b.people:b)?f.length:f,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.program(4,e,0),data:e}))?f:"")+'\n    <tfoot>\n      <tr>\n        <td colspan="2" class="addrow">\n          <a class="btn btn-primary" href="./#mcaction=edit&amp;pid=">\n            <i class="fa fa-plus"></i>\n          </a>\n        </td>\n    </tfoot>\n\n  </table>\n</div>\n'},usePartial:!0,useData:!0}),this.muracontacts.templates.editcontact=window.mura.Handlebars.template({1:function(a,b,c,d,e){var f;return'    <form method="post" class="muracontacts-form">\n      <input type="hidden" name="mcaction" value="delete">\n      <input type="hidden" name="pid" value="'+a.escapeExpression(a.lambda(null!=(f=null!=b?b.contact:b)?f.personid:f,b))+'">\n      <button type="submit" class="btn btn-danger btn-delete">\n        <i class="fa fa-trash"></i>\n      </button>\n    </form>\n'},3:function(a,b,c,d,e){var f;return'    <div class="row">\n      <div class="col-md-12">\n\n        <label>Phone Numbers</label>\n        <ul class="nav muracontacts-phonenumbers">\n\n'+(null!=(f=c.if.call(null!=b?b:{},null!=(f=null!=b?b.phonenumbers:b)?f.length:f,{name:"if",hash:{},fn:a.program(4,e,0),inverse:a.program(7,e,0),data:e}))?f:"")+'\n        </ul>\n\n        <!--- Add Phone --->\n        <div class="pad">\n          <a class="btn btn-success btn-sm muracontacts-addphone-button" href="./#mcaction=editphone&amp;pid='+a.escapeExpression(a.lambda(null!=(f=null!=b?b.contact:b)?f.personid:f,b))+'">\n            <i class="fa fa-plus"></i> Phone\n          </a>\n        </div>\n      </div>\n    </div>\n'},4:function(a,b,c,d,e){var f;return null!=(f=c.each.call(null!=b?b:{},null!=b?b.phonenumbers:b,{name:"each",hash:{},fn:a.program(5,e,0),inverse:a.noop,data:e}))?f:""},5:function(a,b,c,d,e){var f;return null!=(f=a.invokePartial(d.phonelistitem,b,{name:"phonelistitem",data:e,indent:"              ",helpers:c,partials:d,decorators:a.decorators}))?f:""},7:function(a,b,c,d,e){return'            <li class="muracontacts-phonenumber">\n              <i class="fa fa-info-circle"></i> No phone numbers exist yet.\n            </li>\n'},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=null!=b?b:{},h=a.lambda,i=a.escapeExpression;return'<div class="pad">\n  <a class="btn btn-primary" href="./#mcaction=list">\n    <i class="fa fa-arrow-left"></i>\n  </a>\n\n  <!-- Delete -->\n'+(null!=(f=c.if.call(g,null!=(f=null!=b?b.contact:b)?f.exists:f,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.noop,data:e}))?f:"")+"\n</div>\n\n<h3>"+i(h(null!=(f=null!=b?b.contact:b)?f.label:f,b))+' Contact</h3>\n\n<form method="post" class="muracontacts-form pad">\n  <div class="form-group">\n    <label for="namefirst">First Name</label>\n    <input type="text" class="form-control" name="namefirst" value="'+i(h(null!=(f=null!=b?b.contact:b)?f.namefirst:f,b))+'">\n  </div>\n  <div class="form-group">\n    <label for="namelast">Last Name</label>\n    <input type="text" class="form-control" name="namelast" value="'+i(h(null!=(f=null!=b?b.contact:b)?f.namelast:f,b))+'">\n  </div>\n\n  <input type="hidden" name="mcaction" value="edit">\n  <input type="hidden" name="pid" value="'+i(h(null!=(f=null!=b?b.contact:b)?f.personid:f,b))+'">\n  <input type="hidden" name="issubmitted" value="true">\n\n  <button type="submit" class="btn btn-primary">\n    <i class="fa fa-floppy-o"></i>\n  </button>\n  <a class="btn btn-default" href="./#mcaction=list"><i class="fa fa-ban"></i></a>\n</form>\n\n<!-- Phone Number(s) -->\n'+(null!=(f=c.if.call(g,null!=(f=null!=b?b.contact:b)?f.exists:f,{name:"if",hash:{},fn:a.program(3,e,0),inverse:a.noop,data:e}))?f:"")+"<!-- @End Phone Number(s) -->\n"},usePartial:!0,useData:!0}),this.muracontacts.templates.editphone=window.mura.Handlebars.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){return"<h3>Edit Phone</h3>\n"},useData:!0}),this.muracontacts.templates.loggedout=window.mura.Handlebars.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){return'<div class="muracontacts-heading">\n  <h2>MuraContacts</h2>\n</div>\n<p class="alert alert-danger">You must be <a href="./?display=login">logged in</a> to use <strong>MuraContacts</strong></p>\n'},useData:!0}),Mura.DisplayObject.muracontacts=Mura.UI.extend({render:function(){var a=this;Mura(document).on("submit","form.muracontacts-form",function(b){return b.preventDefault(),a.handleForm(Mura.formToObject(b.target)),!1}),a.main()},main:function(){var a=this;Mura.getCurrentUser().then(function(b){a.setLoggedInUser(b.getAll()),1===b.get("isnew")?Mura(a.context.targetEl).html(muracontacts.templates.body({body:muracontacts.templates.loggedout()})):(Mura(window).on("hashchange",function(b){a.handleHash()}),a.handleHash())})},handleForm:function(a){console.log(a)},handleHash:function(){var a=this;switch(a.queryParams=Mura.getQueryStringParams(window.location.hash.replace(/^#/,"")),a.queryParams.mcaction=a.queryParams.mcaction||"list",a.queryParams.mcaction){case"edit":a.renderEditContact();break;case"editphone":a.renderEditPhone();break;case"delete":a.handleDelete();break;default:a.renderList()}},handleDelete:function(){var a=this;a.queryParams=Mura.getQueryStringParams(window.location.hash.replace(/^#/,"")),a.queryParams.pid=a.queryParams.pid||Mura.createUUID(),Mura.getEntity("person").loadBy("personid",a.queryParams.pid).then(function(b){b.delete().then(function(b){console.log(b),a.renderList({text:"Deleted!",type:"success"})},function(b){console.log(b),a.renderBody("Not deleted.")})})},renderList:function(a){var b=this,c=b.getLoggedInUser(),d=c.userid;Mura.getFeed("person").where().prop("userid").isEQ(d).getQuery().then(function(c){b.renderBody(muracontacts.templates.contactlisttable({people:c.get("items")}),a)},function(a){console.warn("Error getting PERSON feed"),console.log(a)})},renderEditContact:function(){var a=this;a.queryParams=Mura.getQueryStringParams(window.location.hash.replace(/^#/,"")),a.queryParams.pid=a.queryParams.pid||Mura.createUUID(),Mura.getBean("person").loadBy("personid",a.queryParams.pid).then(function(b){var c=b.properties,d="",e="";c.exists=0===c.isnew,c.personid=c.exists?c.personid:Mura.createUUID(),c.label=c.exists?"Update":"Add",Mura.getFeed("personphonenumber").where().prop("personid").isEQ(c.personid).getQuery().then(function(b){d=muracontacts.templates.editcontact({contact:c,phonenumbers:b.get("items")}),a.renderBody(d,e)},function(a){console.warn("Error getting PHONENUMBERS feed"),console.log(a)})},function(a){console.warn("Error getting PERSON bean"),console.log(a)})},renderEditPhone:function(){var a=this,b="";a.renderBody(muracontacts.templates.editphone({body:b}))},renderBody:function(a,b){var c=this,a=void 0===a?"":a,d=c.getLoggedInUser();Mura.loader().loadcss(c.getDisplayObjectPath()+"/assets/css/muracontacts.min.css"),Mura(c.context.targetEl).html(muracontacts.templates.body({body:a,message:b,userfirstname:d.fname})),Mura(c.context.targetEl).find(".btn-delete").on("click",function(a){return a.preventDefault(),confirm("Are you sure?")?c.handleDelete():a.preventDefault()})},registerHelpers:function(){},setLoggedInUser:function(a){this.loggedInUser=a},getLoggedInUser:function(){return this.loggedInUser},getDisplayObjectPath:function(){return Mura.themepath+"/display_objects/muracontacts"}});