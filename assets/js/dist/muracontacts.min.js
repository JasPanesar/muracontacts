this.muracontacts=this.muracontacts||{},this.muracontacts.templates=this.muracontacts.templates||{},window.mura.Handlebars.registerPartial("contactlistitem",window.mura.Handlebars.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return'<tr>\n\n  <!-- Contact Name -->\n  <td>\n    <a class="btn" href="./#mcaction=edit&amp;pid='+h(g(null!=(f=null!=b?b.properties:b)?f.personid:f,b))+'">\n      '+h(g(null!=(f=null!=b?b.properties:b)?f.fullname:f,b))+'\n    </a>\n  </td>\n\n  <td class="right">\n    <!-- Edit -->\n    <a class="btn btn-success" href="./#mcaction=edit&amp;pid='+h(g(null!=(f=null!=b?b.properties:b)?f.personid:f,b))+'">\n      <i class="fa fa-pencil"></i>\n    </a>\n\n    <!-- Delete -->\n    <form method="post" class="muracontacts-form muracontacts-formlink">\n      <input type="hidden" name="mcaction" value="delete">\n      <input type="hidden" name="pid" value="'+h(g(null!=(f=null!=b?b.properties:b)?f.personid:f,b))+'">\n      <button type="submit" class="btn btn-danger btn-delete btn-delete-contact">\n        <i class="fa fa-trash"></i>\n      </button>\n    </form>\n  </td>\n\n</tr>\n'},useData:!0})),window.mura.Handlebars.registerPartial("phonelistitem",window.mura.Handlebars.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=null!=b?b:{},h=c.helperMissing,i="function",j=a.escapeExpression;return'<li class="muracontacts-phonenumber">\n  <!-- Edit -->\n  <a class="btn btn-sm btn-primary" href="./#mcaction=editphone&amp;pid='+j((f=null!=(f=c.personid||(null!=b?b.personid:b))?f:h,typeof f===i?f.call(g,{name:"personid",hash:{},data:e}):f))+"&amp;phoneid="+j((f=null!=(f=c.phonenumberid||(null!=b?b.phonenumberid:b))?f:h,typeof f===i?f.call(g,{name:"phonenumberid",hash:{},data:e}):f))+'">\n    <i class="fa fa-pencil"></i>\n  </a>\n\n  <!-- Phone Number -->\n  <a class="btn" href="tel:'+j((f=null!=(f=c.phonenumber||(null!=b?b.phonenumber:b))?f:h,typeof f===i?f.call(g,{name:"phonenumber",hash:{},data:e}):f))+'">\n    '+j((f=null!=(f=c.phonenumber||(null!=b?b.phonenumber:b))?f:h,typeof f===i?f.call(g,{name:"phonenumber",hash:{},data:e}):f))+"\n    <strong>"+j((f=null!=(f=c.phonetype||(null!=b?b.phonetype:b))?f:h,typeof f===i?f.call(g,{name:"phonetype",hash:{},data:e}):f))+"</strong>\n  </a>\n</li>\n"},useData:!0})),this.muracontacts.templates.body=window.mura.Handlebars.template({1:function(a,b,c,d,e){var f;return'    <div class="muracontacts-heading">\n      <h2>'+a.escapeExpression((f=null!=(f=c.userfirstname||(null!=b?b.userfirstname:b))?f:c.helperMissing,"function"==typeof f?f.call(null!=b?b:{},{name:"userfirstname",hash:{},data:e}):f))+"'s Contacts</h2>\n    </div>\n"},3:function(a,b,c,d,e){var f,g=a.lambda;return'    <div class="muracontacts-alert alert alert-'+a.escapeExpression(g(null!=(f=null!=b?b.message:b)?f.type:f,b))+' alert-dismissible" role="alert">\n      <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n      <p>'+(null!=(f=g(null!=(f=null!=b?b.message:b)?f.text:f,b))?f:"")+"</p>\n    </div>\n"},5:function(a,b,c,d,e){var f,g;return'    <div class="muracontacts-body">\n      '+(null!=(g=null!=(g=c.body||(null!=b?b.body:b))?g:c.helperMissing,f="function"==typeof g?g.call(null!=b?b:{},{name:"body",hash:{},data:e}):g)?f:"")+"\n    </div>\n"},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=null!=b?b:{};return'<div class="muracontacts-wrapper">\n\n  <!-- Heading -->\n'+(null!=(f=c.if.call(g,null!=b?b.userfirstname:b,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.noop,data:e}))?f:"")+"\n  <!-- Messaging -->\n"+(null!=(f=c.if.call(g,null!=b?b.hasmessage:b,{name:"if",hash:{},fn:a.program(3,e,0),inverse:a.noop,data:e}))?f:"")+"\n  <!-- Body -->\n"+(null!=(f=c.if.call(g,null!=b?b.body:b,{name:"if",hash:{},fn:a.program(5,e,0),inverse:a.noop,data:e}))?f:"")+"\n</div>\n<!-- @end muracontacts-wrapper -->\n"},useData:!0}),this.muracontacts.templates.contactlisttable=window.mura.Handlebars.template({1:function(a,b,c,d,e){var f;return null!=(f=c.each.call(null!=b?b:{},null!=b?b.people:b,{name:"each",hash:{},fn:a.program(2,e,0),inverse:a.noop,data:e}))?f:""},2:function(a,b,c,d,e){var f;return null!=(f=a.invokePartial(d.contactlistitem,b,{name:"contactlistitem",data:e,indent:"        ",helpers:c,partials:d,decorators:a.decorators}))?f:""},4:function(a,b,c,d,e){return'      <tr>\n        <td colspan="2" class="info">\n          <i class="fa fa-info-circle"></i> No contacts exist yet.\n        </td>\n      </tr>\n'},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="table-responsive">\n  <table class="table-condensed table-hover">\n\n    <thead>\n      <tr>\n        <th>Name</th>\n        <th>&nbsp;</th>\n      </tr>\n    </thead>\n\n'+(null!=(f=c.if.call(null!=b?b:{},null!=(f=null!=b?b.people:b)?f.length:f,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.program(4,e,0),data:e}))?f:"")+'\n    <tfoot>\n      <tr>\n        <td colspan="2" class="addrow">\n          <a class="btn btn-primary" href="./#mcaction=edit&amp;pid=">\n            <i class="fa fa-plus"></i>\n          </a>\n        </td>\n    </tfoot>\n\n  </table>\n</div>\n'},usePartial:!0,useData:!0}),this.muracontacts.templates.editcontact=window.mura.Handlebars.template({1:function(a,b,c,d,e){var f;return'    <form method="post" class="muracontacts-form muracontacts-formlink">\n      <input type="hidden" name="mcaction" value="delete">\n      <input type="hidden" name="pid" value="'+a.escapeExpression(a.lambda(null!=(f=null!=b?b.contact:b)?f.personid:f,b))+'">\n      <button type="submit" class="btn btn-danger btn-delete btn-delete-contact">\n        <i class="fa fa-trash"></i>\n      </button>\n    </form>\n'},3:function(a,b,c,d,e){var f;return'    <div class="row">\n      <div class="col-md-12">\n\n        <label>Phone Numbers</label>\n        <ul class="nav muracontacts-phonenumbers">\n\n'+(null!=(f=c.if.call(null!=b?b:{},null!=(f=null!=b?b.phonenumbers:b)?f.length:f,{name:"if",hash:{},fn:a.program(4,e,0),inverse:a.program(7,e,0),data:e}))?f:"")+'\n        </ul>\n\n        <!--- Add Phone --->\n        <div class="pad">\n          <a class="btn btn-success btn-sm muracontacts-addphone-button" href="./#mcaction=editphone&amp;pid='+a.escapeExpression(a.lambda(null!=(f=null!=b?b.contact:b)?f.personid:f,b))+'">\n            <i class="fa fa-plus"></i> Phone\n          </a>\n        </div>\n      </div>\n    </div>\n'},4:function(a,b,c,d,e){var f;return null!=(f=c.each.call(null!=b?b:{},null!=b?b.phonenumbers:b,{name:"each",hash:{},fn:a.program(5,e,0),inverse:a.noop,data:e}))?f:""},5:function(a,b,c,d,e){var f;return null!=(f=a.invokePartial(d.phonelistitem,b,{name:"phonelistitem",data:e,indent:"              ",helpers:c,partials:d,decorators:a.decorators}))?f:""},7:function(a,b,c,d,e){return'            <li class="muracontacts-phonenumber">\n              <i class="fa fa-info-circle"></i> No phone numbers exist yet.\n            </li>\n'},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=null!=b?b:{},h=a.lambda,i=a.escapeExpression;return'<div class="pad">\n  <a class="btn btn-primary" href="./#mcaction=list">\n    <i class="fa fa-arrow-left"></i>\n  </a>\n\n  <!-- Delete -->\n'+(null!=(f=c.if.call(g,null!=(f=null!=b?b.contact:b)?f.exists:f,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.noop,data:e}))?f:"")+"</div>\n\n<h3>"+i(h(null!=(f=null!=b?b.contact:b)?f.label:f,b))+' Contact</h3>\n\n<form method="post" class="muracontacts-form pad">\n  <div class="form-group">\n    <label for="namefirst">First Name</label>\n    <input type="text" class="form-control" name="namefirst" value="'+i(h(null!=(f=null!=b?b.contact:b)?f.namefirst:f,b))+'">\n  </div>\n  <div class="form-group">\n    <label for="namelast">Last Name</label>\n    <input type="text" class="form-control" name="namelast" value="'+i(h(null!=(f=null!=b?b.contact:b)?f.namelast:f,b))+'">\n  </div>\n\n  <input type="hidden" name="mcaction" value="savecontact">\n  <input type="hidden" name="personid" value="'+i(h(null!=(f=null!=b?b.contact:b)?f.personid:f,b))+'">\n\n  <button type="submit" class="btn btn-primary">\n    <i class="fa fa-floppy-o"></i>\n  </button>\n  <a class="btn btn-default" href="./#mcaction=list"><i class="fa fa-ban"></i></a>\n</form>\n\n<!-- Phone Number(s) -->\n'+(null!=(f=c.if.call(g,null!=(f=null!=b?b.contact:b)?f.exists:f,{name:"if",hash:{},fn:a.program(3,e,0),inverse:a.noop,data:e}))?f:"")+"<!-- @End Phone Number(s) -->\n"},usePartial:!0,useData:!0}),this.muracontacts.templates.editphone=window.mura.Handlebars.template({1:function(a,b,c,d,e){var f;return'    <form class="muracontacts-formlink">\n      <input type="hidden" name="mcaction" value="deletephone">\n      <input type="hidden" name="phoneid" value="'+a.escapeExpression(a.lambda(null!=(f=null!=b?b.phone:b)?f.phoneid:f,b))+'">\n      <button type="submit" class="btn btn-danger btn-delete">\n        <i class="fa fa-trash"></i>\n      </button>\n    </form>\n'},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g,h=null!=b?b:{},i=a.escapeExpression,j=a.lambda;return i(c.log.call(h,null!=b?b.phone:b,{name:"log",hash:{},data:e}))+'\n<div class="pad">\n  <a class="btn btn-primary" href="./#mcaction=edit&amp;pid='+i(j(null!=(f=null!=b?b.phone:b)?f.personid:f,b))+'">\n    <i class="fa fa-arrow-left"></i>\n  </a>\n\n  <!--- Delete --->\n'+(null!=(f=c.if.call(h,null!=b?b.phoneexists:b,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.noop,data:e}))?f:"")+"</div>\n\n<h4>"+i(j(null!=(f=null!=b?b.phone:b)?f.label:f,b))+' Phone</h4>\n\n<form method="post" class="muracontacts-form">\n  <div class="form-group">\n    <label for="phonenumber">Phone Number</label>\n    <input type="text" class="form-control" name="phonenumber" value="'+i(j(null!=(f=null!=b?b.phone:b)?f.phonenumber:f,b))+'">\n  </div>\n  <div class="form-group">\n    <label for="phonetype">Phone Type</label>\n    <select name="phonetype" class="form-control">\n      <option value="">- Select -</option>\n\n      <cfloop array="#phonetypes#" index="phonetype">\n        <option value="'+i((g=null!=(g=c.phonetype||(null!=b?b.phonetype:b))?g:c.helperMissing,"function"==typeof g?g.call(h,{name:"phonetype",hash:{},data:e}):g))+'"<cfif phoneNumberBean.get(\'phonetype\') eq phonetype> selected="selected"</cfif>>\n          #phonetype#\n        </option>\n      </cfloop>\n\n    </select>\n  </div>\n\n  <input type="hidden" name="mcaction" value="editphone">\n  <input type="hidden" name="personid" value="'+i(j(null!=(f=null!=b?b.phone:b)?f.personid:f,b))+'">\n  <input type="hidden" name="phoneid" value="'+i(j(null!=(f=null!=b?b.phone:b)?f.phonenumberid:f,b))+'">\n  <input type="hidden" name="issubmitted" value="true">\n\n  <button type="submit" class="btn btn-primary">\n    <i class="fa fa-floppy-o"></i>\n  </button>\n  <a class="btn btn-default" href="./#mcaction=edit&amp;pid='+i(j(null!=(f=null!=b?b.phone:b)?f.personid:f,b))+'"><i class="fa fa-ban"></i></a>\n</form>\n'},useData:!0}),this.muracontacts.templates.errormessages=window.mura.Handlebars.template({1:function(a,b,c,d,e){var f;return"    <li>"+(null!=(f=a.lambda(b,b))?f:"")+"</li>\n"},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<h4><i class="fa fa-exclamation-triangle"></i> Ooops!</h4>\n<ul>\n'+(null!=(f=c.each.call(null!=b?b:{},null!=b?b.errors:b,{name:"each",hash:{},fn:a.program(1,e,0),inverse:a.noop,data:e}))?f:"")+"</ul>\n"},useData:!0}),this.muracontacts.templates.loggedout=window.mura.Handlebars.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){return'<div class="muracontacts-heading">\n  <h2>MuraContacts</h2>\n</div>\n<p class="alert alert-danger">You must be <a href="./?display=login">logged in</a> to use <strong>MuraContacts</strong></p>\n'},useData:!0}),Mura.DisplayObject.muracontacts=Mura.UI.extend({render:function(){this.container=jQuery(Mura(this.context.targetEl).node),this.main()},main:function(){var a=this;Mura.getCurrentUser().then(function(b){a.setLoggedInUser(b.getAll()),1===b.get("isnew")?a.container.html(muracontacts.templates.body({body:muracontacts.templates.loggedout()})):(Mura(window).on("hashchange",function(b){a.handleHash()}),a.container.on("click",".muracontacts-wrapper .btn-delete",function(a){return!!confirm("Are you sure?")||a.preventDefault()}),a.container.on("submit",".muracontacts-wrapper form",function(b){return b.preventDefault(),a.handleForm(Mura.formToObject(b.target)),!1}),a.handleHash())})},routeAction:function(a,b){var c=this,a=void 0===a?"list":a,b=void 0===b?{}:b;switch(a){case"edit":c.renderEditContact(b);break;case"editphone":c.renderEditPhone(b);break;case"savecontact":c.handleSaveContact(b);break;case"savephone":c.handleSavePhone(b);break;case"delete":c.handleDeleteContact(b);break;default:c.renderList()}},handleForm:function(a){var b=void 0===a.mcaction?"list":a.mcaction;this.routeAction(b,a)},handleHash:function(){var a=this;a.queryParams=Mura.getQueryStringParams(window.location.hash.replace(/^#/,"")),a.queryParams.mcaction=a.queryParams.mcaction||"list",a.routeAction(a.queryParams.mcaction)},handleSaveContact:function(a){var b=this;Mura.getEntity("person").loadBy("personid",a.personid).then(function(c){var d=0===c.get("isnew");d||(a.userid=b.getLoggedInUser().userid),c.set(a).save().then(function(c){var e=d?"Updated!":"Added!";b.setMessage({text:e,type:"success"}),b.renderEditContact(a)},function(c){var d=muracontacts.templates.errormessages({errors:c.get("errors")});b.setMessage({text:d,type:"danger"}),b.renderEditContact(a)})})},handleDeleteContact:function(a){var b=this;Mura.getEntity("person").loadBy("personid",a.pid).then(function(a){a.delete().then(function(a){b.setMessage({text:"Deleted!",type:"success"}),b.renderList()},function(a){b.setMessage({text:"Error deleting!",type:"danger"})})})},renderList:function(){var a=this,b=a.getLoggedInUser(),c=b.userid;"mcaction=list"!==window.location.hash.replace(/^#/,"")&&(window.location.hash="mcaction=list"),Mura.getFeed("person").where().prop("userid").isEQ(c).getQuery().then(function(b){a.renderBody(muracontacts.templates.contactlisttable({people:b.get("items")}))},function(a){console.warn("Error getting PERSON feed"),console.log(a)})},renderEditContact:function(a){var b=this,c=void 0!==a&&a.hasOwnProperty("personid")&&Mura.isUUID(a.personid)?a.personid:Mura.createUUID();b.queryParams=Mura.getQueryStringParams(window.location.hash.replace(/^#/,"")),Mura.isEmptyObject(a)&&(c=void 0!==b.queryParams.pid&&Mura.isUUID(b.queryParams.pid)?b.queryParams.pid:c),b.queryParams.hasOwnProperty("pid")&&Mura.isUUID(b.queryParams.pid)||(window.location.hash="mcaction=edit&pid="+c),Mura.getBean("person").loadBy("personid",c).then(function(d){var e=d.getAll(),f="",g="";e.exists=0===e.isnew,e.personid=e.exists?e.personid:c,e.label=e.exists?"Update":"Add",a.hasOwnProperty("namefirst")&&(e.namefirst=a.namefirst),a.hasOwnProperty("namelast")&&(e.namelast=a.namelast),Mura.getFeed("personphonenumber").where().prop("personid").isEQ(e.personid).getQuery().then(function(a){f=muracontacts.templates.editcontact({contact:e,phonenumbers:a.getAll()}),b.renderBody(f,g)},function(a){console.warn("Error getting PHONENUMBERS feed"),console.log(a)})},function(a){console.warn("Error getting PERSON bean"),console.log(a)})},renderEditPhone:function(a){var b=this,c=void 0!==a&&a.hasOwnProperty("personid")&&Mura.isUUID(a.personid)?a.personid:"",d=void 0!==a&&a.hasOwnProperty("phonenumberid")&&Mura.usUUID(a.phonenumberid)?a.phonenumberid:Mura.createUUID();return b.queryParams=Mura.getQueryStringParams(window.location.hash.replace(/^#/,"")),Mura.isEmptyObject(a)&&(c=void 0!==b.queryParams.pid&&Mura.isUUID(b.queryParams.pid)?b.queryParams.pid:c,d=void 0!==b.queryParams.phonenumberid&&Mura.isUUID(b.queryParams.phonenumberid)?b.queryParams.phonenumberid:d),0===c.length?window.location="./":(b.queryParams.hasOwnProperty("phonenumberid")&&Mura.isUUID(b.queryParams.phonenumberid)||(window.location.hash="mcaction=editphone&pid="+c+"&phonenumberid="+d),void Mura.getBean("personphonenumber").loadBy("phonenumberid",d).then(function(c){var e=c.getAll(),f="",g="";e.exists=0===e.isnew,e.phonenumberid=e.exists?e.phonenumberid:d,e.label=e.exists?"Update":"Add",a.hasOwnProperty("phonenumber")&&(e.phonenumber=a.phonenumber),a.hasOwnProperty("phonetype")&&(e.phonetype=a.phonetype),f=muracontacts.templates.editphone({phone:e}),b.renderBody(f,g)},function(a){console.warn("Error getting PHONENUMBER bean"),console.log(a)}))},renderBody:function(a){var b=this,a=void 0===a?"":a,c=b.getMessage(),d=0!==Object.keys(c).length,e=b.getLoggedInUser();Mura.loader().loadcss(b.getDisplayObjectPath()+"/assets/css/muracontacts.min.css"),b.container.html(muracontacts.templates.body({body:a,hasmessage:d,message:c,userfirstname:e.fname})),d&&setTimeout(function(){$(".muracontacts-alert").fadeOut("slow"),b.setMessage()},2e3)},setLoggedInUser:function(a){this.loggedInUser=a},getLoggedInUser:function(){return this.loggedInUser},setMessage:function(a){this.message=a},getMessage:function(){return void 0===this.message?{}:this.message},getDisplayObjectPath:function(){return Mura.themepath+"/display_objects/muracontacts"},registerHelpers:function(){}});